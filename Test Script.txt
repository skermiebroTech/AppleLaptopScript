-- Prompt user for sudo password
set sudoPassword to text returned of (display dialog "Enter your sudo password:" default answer "" with hidden answer)

-- Connect to WiFi network
do shell script "echo " & quoted form of sudoPassword & " | sudo -S networksetup -setairportnetwork en0 G1-Retail Ebayunit28"
delay 3

-- Set volume to 50%
set volume output volume 70

-- Play sound to test speakers
do shell script "afplay -v 0.5 /Volumes/MACOSSCRIPT/WindowsXPStartup.wav"

-- Open Camera
tell application "Photo Booth"
    activate
end tell

-- Get battery data
set battery_data to do shell script "echo " & quoted form of sudoPassword & " | sudo -S system_profiler SPPowerDataType"

-- Extract battery cycles, current capacity, and design capacity
set cycle_count to missing value
set current_capacity to missing value
set design_capacity to missing value

repeat with lineText in paragraphs of battery_data
    if lineText contains "Cycle Count" then
        set cycle_count to word -2 of lineText
    else if lineText contains "Full Charge Capacity" then
        set current_capacity to last word of lineText
    else if lineText contains "Design Capacity" then
        set design_capacity to last word of lineText
    end if
end repeat

-- Calculate battery percentage
if cycle_count is not missing value and current_capacity is not missing value and design_capacity is not missing value then
    set battery_percentage to round ((current_capacity / design_capacity) * 100)
    
    -- Display battery cycles and percentage
    display dialog "Battery Cycles: " & cycle_count & return & "Battery Percentage: " & battery_percentage & "%" & return & "Click OK to run MDM check"
    
    -- Renew enrollment profile
    do shell script "echo " & quoted form of sudoPassword & " | sudo -S profiles renew -type enrollment"
else
    display dialog "Error: Failed to retrieve battery information." buttons {"OK"} default button "OK" with icon stop
end if
